<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prompt å­¸ç¿’æ›¸</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0f0f23;--bg2:#1a1a2e;--bg3:#16213e;
  --tx:#e8e8e8;--tx2:#a8a8a8;--tx3:#6c6c8a;
  --ac:#4a90e2;--ac2:#e94b77;--ac3:#4ecdc4;--ac4:#f9ca24;
  --brd:rgba(255,255,255,.08);--shd:rgba(0,0,0,.3);
}
body.light{
  --bg:#f5f5f5;--bg2:#fff;--bg3:#e8edf2;
  --tx:#2c3e50;--tx2:#7f8c8d;--tx3:#b0b0b0;
  --brd:rgba(0,0,0,.08);--shd:rgba(0,0,0,.06);
}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans TC",sans-serif;background:var(--bg);color:var(--tx);line-height:1.6}

/* Layout */
.app{display:flex;min-height:100vh}

/* Sidebar */
.sidebar{width:240px;background:var(--bg2);border-right:1px solid var(--brd);position:fixed;height:100vh;overflow-y:auto;z-index:100;transition:transform .3s}
.sidebar.hidden{transform:translateX(-100%)}
.sidebar-hdr{padding:16px;border-bottom:1px solid var(--brd)}
.sidebar-hdr h1{font-size:1rem;margin-bottom:4px}
.sidebar-hdr a{color:var(--ac);text-decoration:none;font-size:.8rem}
.nav-item{padding:10px 16px;cursor:pointer;border-left:3px solid transparent;font-size:.85rem;transition:all .2s;display:flex;justify-content:space-between;align-items:center}
.nav-item:hover{background:var(--bg3);border-left-color:var(--ac)}
.nav-item.active{background:var(--bg3);border-left-color:var(--ac);font-weight:600}
.nav-badge{font-size:.7rem;background:var(--ac);color:#fff;border-radius:10px;padding:1px 6px}
.nav-links{padding:12px 16px;border-top:1px solid var(--brd);display:flex;flex-direction:column;gap:8px}
.nav-links a{color:var(--tx2);text-decoration:none;font-size:.82rem;transition:color .2s}
.nav-links a:hover{color:var(--ac)}

/* Main */
.main{flex:1;margin-left:240px;display:flex;flex-direction:column;min-height:100vh}
.main.expanded{margin-left:0}

/* Toolbar */
.toolbar{padding:12px 24px;background:var(--bg2);border-bottom:1px solid var(--brd);display:flex;gap:8px;align-items:center;flex-wrap:wrap;position:sticky;top:0;z-index:50}
.toolbar input{flex:1;min-width:180px;padding:8px 12px;border:1px solid var(--brd);border-radius:6px;background:var(--bg);color:var(--tx);font-size:.85rem;outline:none}
.toolbar input:focus{border-color:var(--ac)}
.btn{padding:6px 12px;border:1px solid var(--brd);border-radius:6px;background:var(--bg2);color:var(--tx);cursor:pointer;font-size:.78rem;transition:all .2s;white-space:nowrap}
.btn:hover{background:var(--bg3);border-color:var(--ac)}

/* Toggle sidebar (mobile) */
.toggle-sidebar{position:fixed;top:12px;left:12px;z-index:200;background:var(--bg2);border:1px solid var(--brd);border-radius:6px;padding:6px 10px;cursor:pointer;color:var(--tx);font-size:1rem;display:none}
@media(max-width:900px){.sidebar{transform:translateX(-100%)}.sidebar.show{transform:translateX(0)}.main{margin-left:0!important}.toggle-sidebar{display:block}}

/* Card */
.card-container{flex:1;padding:24px;display:flex;align-items:flex-start;justify-content:center}
.card{display:flex;gap:24px;max-width:960px;width:100%;background:var(--bg2);border:1px solid var(--brd);border-radius:12px;overflow:hidden;min-height:400px}
.card-img{flex:0 0 50%;max-width:50%;background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
.card-img img{width:100%;height:100%;object-fit:contain;max-height:80vh}
.card-img .no-img{color:var(--tx3);font-size:.9rem;padding:40px;text-align:center}
.card-body{flex:1;padding:24px;overflow-y:auto;max-height:80vh}
.card-body .chapter-tag{display:inline-block;padding:2px 10px;border-radius:12px;font-size:.72rem;font-weight:600;margin-bottom:12px;color:#fff}
.ch-1{background:#e94b77}.ch-2{background:#4a90e2}.ch-3{background:#4ecdc4}
.ch-4{background:#f9ca24;color:#333}.ch-5{background:#9b59b6}.ch-6{background:#e67e22}
.ch-7{background:#1abc9c}.ch-8{background:#3498db}.ch-9{background:#e74c3c}
.card-body h2{font-size:1.2rem;margin-bottom:16px;line-height:1.4}
.card-body .section{margin-bottom:16px}
.card-body .section-label{font-size:.75rem;color:var(--tx2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px;font-weight:600}
.card-body .prompt-text{font-family:"Fira Code",monospace;font-size:.8rem;background:var(--bg);border:1px solid var(--brd);border-radius:6px;padding:12px;line-height:1.7;white-space:pre-wrap;word-break:break-all;max-height:200px;overflow-y:auto;color:var(--tx)}
.card-body .commentary{font-size:.88rem;line-height:1.8;color:var(--tx)}
.card-body .elements-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-top:8px}
.card-body .element-group{background:var(--bg);border:1px solid var(--brd);border-radius:6px;padding:8px;font-size:.78rem}
.card-body .element-group-title{font-size:.68rem;color:var(--tx2);margin-bottom:4px;font-weight:600}
.card-body .element-group-items{color:var(--tx);line-height:1.5}
.card-body .tags{display:flex;flex-wrap:wrap;gap:6px}
.card-body .tag{padding:3px 10px;border-radius:4px;font-size:.78rem;background:var(--bg3);border:1px solid var(--brd);color:var(--tx);cursor:pointer;transition:all .15s}
.card-body .tag:hover{border-color:var(--ac);color:var(--ac)}
.card-body .vocab-tag{background:rgba(74,144,226,.1);border-color:rgba(74,144,226,.3);color:var(--ac)}
.card-body .score-badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:.72rem;font-weight:600;margin-left:8px}
.score-high{background:rgba(46,204,113,.15);color:#2ecc71}
.score-mid{background:rgba(241,196,15,.15);color:#f1c40f}

/* Pagination */
.pagination{padding:16px 24px;background:var(--bg2);border-top:1px solid var(--brd);display:flex;align-items:center;justify-content:center;gap:12px}
.pagination .btn{min-width:100px;text-align:center}
.pagination .page-info{font-size:.85rem;color:var(--tx2);text-align:center;display:flex;align-items:center;gap:6px}
.pagination .page-input{width:50px;padding:4px 6px;border:1px solid var(--brd);border-radius:4px;background:var(--bg);color:var(--tx);font-size:.85rem;text-align:center}
.pagination .page-input:focus{border-color:var(--ac);outline:none}
.pagination .page-total{color:var(--tx3)}

/* Chapter colors for nav */
.nav-ch-1{border-left-color:#e94b77!important}
.nav-ch-2{border-left-color:#4a90e2!important}
.nav-ch-3{border-left-color:#4ecdc4!important}
.nav-ch-4{border-left-color:#f9ca24!important}
.nav-ch-5{border-left-color:#9b59b6!important}
.nav-ch-6{border-left-color:#e67e22!important}
.nav-ch-7{border-left-color:#1abc9c!important}
.nav-ch-8{border-left-color:#3498db!important}
.nav-ch-9{border-left-color:#e74c3c!important}

/* Responsive */
@media(max-width:700px){
  .card{flex-direction:column}
  .card-img{flex:none;max-width:100%;max-height:50vh}
  .card-body{max-height:none}
}
</style>
</head>
<body>
<button class="toggle-sidebar" onclick="document.getElementById('sidebar').classList.toggle('show')">&#9776;</button>
<div class="app">
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-hdr">
      <h1>Prompt å­¸ç¿’æ›¸</h1>
      <a href="index.html">&larr; å›é¦–é </a>
    </div>
    <div id="nav"></div>
    <div class="nav-links">
      <a href="dictionary.html">ğŸ“š è©å½™è¾­å…¸</a>
      <a href="index.html">ğŸ  é¦–é </a>
    </div>
  </nav>
  <div class="main" id="main">
    <div class="toolbar">
      <input type="text" id="search" placeholder="æœå°‹ prompt å…§å®¹..." oninput="onSearch(this.value)">
      <button class="btn" id="themeBtn" onclick="toggleTheme()">â˜€ï¸</button>
    </div>
    <div class="card-container" id="cardContainer">
      <div style="color:var(--tx2);text-align:center;padding:60px">è¼‰å…¥ä¸­...</div>
    </div>
    <div class="pagination">
      <button class="btn" id="prevBtn" onclick="navigate(-1)">&larr; ä¸Šä¸€å€‹</button>
      <span class="page-info">
        <input type="number" class="page-input" id="pageInput" min="1" value="1" onchange="goToPage(this.value)" onkeydown="if(event.key==='Enter')goToPage(this.value)">
        <span class="page-total">/ <span id="pageTotal">0</span></span>
      </span>
      <button class="btn" id="nextBtn" onclick="navigate(1)">ä¸‹ä¸€å€‹ &rarr;</button>
    </div>
  </div>
</div>

<script>
const CHAPTERS={1:"äººç‰©ä¸»é«”",2:"æœè£",3:"å ´æ™¯",4:"å…‰å½±",5:"é¡é ­æ§‹åœ–",6:"é¢¨æ ¼",7:"è‰²å½©",8:"å“è³ªæ§åˆ¶",9:"ç‰¹æ®ŠæŠ€æ³•"};
let DATA=null,filtered=[],currentIdx=0,currentChapter=0;

// Load data
fetch("data/curated.json")
  .then(r=>r.json())
  .then(d=>{DATA=d;init();})
  .catch(e=>{document.getElementById("cardContainer").innerHTML=`<div style="color:var(--ac2);padding:60px;text-align:center">è¼‰å…¥å¤±æ•—: ${e.message}<br><br>è«‹ç¢ºèª data/curated.json å­˜åœ¨</div>`;});

function init(){
  filtered=DATA.examples.slice();
  buildNav();
  renderCard();
}

function buildNav(){
  const nav=document.getElementById("nav");
  nav.innerHTML="";
  // All
  const all=document.createElement("div");
  all.className="nav-item"+(currentChapter===0?" active":"");
  all.innerHTML=`<span>å…¨éƒ¨</span><span class="nav-badge">${DATA.examples.length}</span>`;
  all.onclick=()=>switchChapter(0);
  nav.appendChild(all);
  // Chapters
  for(let ch=1;ch<=9;ch++){
    const count=DATA.examples.filter(e=>e.chapter===ch).length;
    if(count===0)continue;
    const el=document.createElement("div");
    el.className=`nav-item nav-ch-${ch}`+(currentChapter===ch?" active":"");
    el.innerHTML=`<span>ç¬¬${ch}ç«  ${CHAPTERS[ch]}</span><span class="nav-badge">${count}</span>`;
    el.onclick=(()=>{const c=ch;return()=>switchChapter(c);})();
    nav.appendChild(el);
  }
}

function switchChapter(ch){
  currentChapter=ch;
  currentIdx=0;
  applyFilter();
  buildNav();
  renderCard();
}

function applyFilter(){
  let result=DATA.examples;
  if(currentChapter>0)result=result.filter(e=>e.chapter===currentChapter);
  const q=document.getElementById("search").value.trim().toLowerCase();
  if(q)result=result.filter(e=>(e.prompt||"").toLowerCase().includes(q)||(e.title||"").toLowerCase().includes(q)||(e.commentary||"").toLowerCase().includes(q));
  filtered=result;
  if(currentIdx>=filtered.length)currentIdx=Math.max(0,filtered.length-1);
}

function onSearch(q){
  currentIdx=0;
  applyFilter();
  renderCard();
}

function navigate(dir){
  currentIdx+=dir;
  if(currentIdx<0)currentIdx=filtered.length-1;
  if(currentIdx>=filtered.length)currentIdx=0;
  renderCard();
}

function goToPage(val){
  const page=parseInt(val,10);
  if(isNaN(page)||page<1||page>filtered.length){
    document.getElementById("pageInput").value=currentIdx+1;
    return;
  }
  currentIdx=page-1;
  renderCard();
}

function renderCard(){
  const container=document.getElementById("cardContainer");

  if(!filtered.length){
    container.innerHTML='<div style="color:var(--tx2);padding:60px;text-align:center">æ²’æœ‰ç¬¦åˆçš„ç¯„ä¾‹</div>';
    document.getElementById("pageInput").value=0;
    document.getElementById("pageTotal").textContent=0;
    return;
  }

  const ex=filtered[currentIdx];
  const ch=ex.chapter||ex.primary_chapter||1;
  const scoreBadge=ex.score?`<span class="score-badge ${ex.score>=9?'score-high':'score-mid'}" title="LLM è‡ªå‹•è©•åˆ†ï¼Œåƒ…ä¾›åƒè€ƒ">LLM â˜… ${ex.score}</span>`:"";

  // åŸå…§å®¹ï¼ˆå„ªå…ˆç”¨ original_promptï¼Œå…¶æ¬¡ promptï¼‰
  const originalPrompt=ex.original_prompt||ex.prompt||"(ç„¡æç¤ºè©)";

  // å…ƒç´ æ‹†è§£ï¼ˆæ–°æ ¼å¼ï¼‰
  let elementsHtml='';
  if(ex.elements&&typeof ex.elements==='object'){
    const groups=[];
    for(let i=1;i<=9;i++){
      const items=ex.elements[i]||ex.elements[String(i)]||[];
      if(items.length>0){
        groups.push(`<div class="element-group"><div class="element-group-title">${CHAPTERS[i]}</div><div class="element-group-items">${items.map(x=>escapeHtml(x)).join('ã€')}</div></div>`);
      }
    }
    if(groups.length>0){
      elementsHtml=`<div class="section"><div class="section-label">å…ƒç´ æ‹†è§£</div><div class="elements-grid">${groups.join('')}</div></div>`;
    }
  }

  // èˆŠæ ¼å¼ç›¸å®¹ï¼ˆkey_techniques + vocabulary_usedï¼‰
  let oldFormatHtml='';
  if(!elementsHtml){
    if(ex.key_techniques&&ex.key_techniques.length){
      oldFormatHtml+=`<div class="section"><div class="section-label">é—œéµæŠ€å·§</div><div class="tags">${ex.key_techniques.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('')}</div></div>`;
    }
    if(ex.vocabulary_used&&ex.vocabulary_used.length){
      oldFormatHtml+=`<div class="section"><div class="section-label">ç›¸é—œè©å½™</div><div class="tags">${ex.vocabulary_used.map(v=>`<a class="tag vocab-tag" href="dictionary.html#${encodeURIComponent(v)}" target="_blank">${escapeHtml(v)}</a>`).join('')}</div></div>`;
    }
  }

  // æ•™å­¸é»è©•ï¼ˆèˆŠè³‡æ–™æœ‰ï¼Œæ–°è³‡æ–™å¯èƒ½æ²’æœ‰ï¼‰
  const commentaryHtml=ex.commentary?`<div class="section"><div class="section-label">æ•™å­¸é»è©•</div><div class="commentary">${escapeHtml(ex.commentary)}</div></div>`:'';

  container.innerHTML=`
<div class="card">
  <div class="card-img">
    <img src="${ex.image}" alt="${ex.title||''}" onerror="this.parentElement.innerHTML='<div class=no-img>åœ–ç‰‡è¼‰å…¥å¤±æ•—<br>${ex.image}</div>'" loading="lazy">
  </div>
  <div class="card-body">
    <span class="chapter-tag ch-${ch}">ç¬¬${ch}ç«  ${CHAPTERS[ch]||''}</span>${scoreBadge}
    <h2>${ex.title||'Prompt ç¯„ä¾‹'}</h2>

    <div class="section">
      <div class="section-label">åŸå…§å®¹</div>
      <div class="prompt-text">${escapeHtml(originalPrompt)}</div>
    </div>

    ${elementsHtml}
    ${oldFormatHtml}
    ${commentaryHtml}

    <div class="section" style="margin-top:12px">
      <div style="font-size:.72rem;color:var(--tx3)">ID: ${ex.id} | é¡å‹: ${ex.prompt_type||'â€”'}</div>
    </div>
  </div>
</div>`;

  document.getElementById("pageInput").value=currentIdx+1;
  document.getElementById("pageInput").max=filtered.length;
  document.getElementById("pageTotal").textContent=filtered.length;
}

function escapeHtml(s){
  const d=document.createElement('div');d.textContent=s;return d.innerHTML;
}

// Keyboard nav
document.addEventListener("keydown",e=>{
  if(e.target.tagName==="INPUT")return;
  if(e.key==="ArrowLeft"||e.key==="ArrowUp")navigate(-1);
  if(e.key==="ArrowRight"||e.key==="ArrowDown")navigate(1);
});

// Theme
function toggleTheme(){
  document.body.classList.toggle("light");
  const isLight=document.body.classList.contains("light");
  document.getElementById("themeBtn").textContent=isLight?"ğŸŒ™":"â˜€ï¸";
  localStorage.setItem("book-theme",isLight?"light":"dark");
}
if(localStorage.getItem("book-theme")==="light"){
  document.body.classList.add("light");
  document.getElementById("themeBtn").textContent="ğŸŒ™";
}
</script>
</body>
</html>